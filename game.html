<html>
  <head>
    <script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
	<script src="https://code.createjs.com/1.0.0/soundjs.min.js"></script>
    <script> 
	class TreeNode {
		constructor(value) {
		this.value = value;
		this.descendants = [];
		}
	}
	var dataTree = new TreeNode("root");
	dataTree.descendants.push(new TreeNode("lostandfound"));
	var historial = "Welcome to Mauri's game\nGGJ21\n\n";
	var linea = ">";
	var path ="root\\";
	var isLSAvailable = false;
	var isCDAvailable = false;
	var isMVAvailable = false;
	var isPointsAvailable = false;
	var text = new createjs.Text(historial + path + linea, "20px Courier", "#00ff00");
	var stage;// = new createjs.Stage("demoCanvas");
    function init() {
		stage = new createjs.Stage("demoCanvas");
		stage.addChild(text)
        stage.update();
    }
	
	function fidnNodeInDataTree(pathToCheck, structure)
	{   if (pathToCheck.slice(0,-1) == structure.value.toLowerCase())
		{
			return structure;
		}
		else
		{
			var firstFolder = pathToCheck.slice(0,pathToCheck.indexOf("\\"));
			for(var i = 0; i < structure.descendants.length; i++)
			{
				if (firstFolder == structure.descendants[i])
				{
					return fidnNodeInDataTree(pathToCheck.slice(pathToCheck.indexOf("\\") + 1), structure.descendants[i]);
				}
			}
			return 0;
		}
	}
	
	function printFoldersAtLocation()
	{
		var currentLocation = fidnNodeInDataTree(path, dataTree);
		if (currentLocation != 0)
		{
			currentLocation.descendants.forEach(element =>historial = historial + element.value + " ");
			historial = historial + "\n";
		}
	}
	function parseCommand(commandLine) {
		var command = (commandLine.includes(" ")) ? commandLine.substr(0, commandLine.indexOf(" ")) : commandLine;
		var args = commandLine.substr(commandLine.indexOf(" "));
		if (command === ">help")
		{
			// shows available commands
			historial = historial + "\nhelp\nls lists available folders\n";
			if (isCDAvailable)
			{
				historial = historial + "cd concats param path to current path. If param is .. it goes back one level if possible path\n";
			}
			if (isMVAvailable)
			{
				historial = historial + "mv moves folder param1 to param2\n";
			}
			if (isPointsAvailable)
			{
				historial = historial + "points shows points\n";
			}
			
			isLSAvailable = true;
		}
		else if (command === ">cd" && isCDAvailable)
		{
			// todo validate valid path
			isMVAvailable = true;
			path = path + args.slice(1) + "\\";
		}
		else if (command === ">ls" && isLSAvailable)
		{
			isCDAvailable = true;
			printFoldersAtLocation();
		}
		else if (command === ">mv" && isMVAvailable) 
		{
			isPointsAvailable = true;
			alert("mv " + args);
		}
		else if (command == ">points" && isPointsAvailable)
		{
			var currentPoints = 0; //GetPoints();
			historial = historial + "Current Points " + currentPoints + "\n";
		}
	}

	document.onkeyup = function(e) {
	  if(window.event) { // IE                  
		keynum = e.keyCode;
	  } else if(e.which){ // Netscape/Firefox/Opera                 
		keynum = e.which;
	  }
	  if (keynum === 8)
	  {
			linea = linea.slice(0,-1);
	  }
	  else if(keynum === 13)
	  {
			historial = historial + linea + "\n";
			parseCommand(linea);
			linea = ">";
	  }
	  else
	  {
		  linea  = linea + String.fromCharCode(keynum).toLowerCase();
	  }
	  stage.removeChild(text);
	  text = new createjs.Text(historial + path + linea, "20px Courier", "#00ff00");
	  stage.clear();
	  stage.addChild(text);
	  stage.update();
	}
    </script>
	
	
  </head>
  <body onload="init();"  id="char" bgcolor=black>
    <canvas id="demoCanvas" width="500" height="900"></canvas>
  </body>
</html>
